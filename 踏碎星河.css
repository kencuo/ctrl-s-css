:root {
    /* === æ˜Ÿé™…æ·±ç©ºé…è‰²å˜é‡ === */
    --xuexitong-blue: #81A1F8;
    --xuexitong-blue-light: #A5B4FC;
    --xuexitong-blue-dark: #1E293B;
    --xuexitong-sidebar: #050508;
    --xuexitong-bg: #020205;
    --xuexitong-card: #0F172A;
    --xuexitong-text: #E2E8F0;
    --xuexitong-text-light: #94A3B8;
    --xuexitong-text-muted: #64748B;
    --xuexitong-border: rgba(255, 255, 255, 0.08);
    --xuexitong-accent: #38BDF8;
}

body {
    background-color: var(--xuexitong-bg) !important;
    color: var(--xuexitong-text) !important;
    font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif !important;
    overflow-x: hidden !important; /* é˜²æ­¢æ»šåŠ¨æ¡ */
}

/* =================================================================
   === ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç»ˆæèƒŒæ™¯æ¨¡ç³Šæ–¹æ¡ˆ ===
   ================================================================= */

/* 1. åˆ›å»ºä¸€ä¸ªè¶…åº•å±‚ä¼ªå…ƒç´ ï¼Œä¸“é—¨ç”¨æ¥æ”¾èƒŒæ™¯å›¾å¹¶æ¨¡ç³Šå®ƒ */
body::before {
    content: "" !important;
    position: fixed !important;
    top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: -999 !important; /* æ”¾åœ¨æœ€æœ€æœ€åº•ä¸‹ */
    
    background-image: url('https://files.catbox.moe/pd4la6.jpeg') !important;
    background-size: cover !important;
    background-position: center !important;
    background-attachment: fixed !important;

    /* === å…³é”®ï¼ç›´æ¥å¯¹èƒŒæ™¯å±‚ä½¿ç”¨å¼ºåŠ›æ¨¡ç³Šå’Œå‹æš— === */
    filter: blur(5px) brightness(0.7) !important; 
    
    /* ç¨å¾®æ”¾å¤§ä¸€ç‚¹ï¼Œé˜²æ­¢æ¨¡ç³Šè¾¹ç¼˜å‡ºç°ç™½è¾¹ */
    transform: scale(1.1) !important; 
    pointer-events: none !important;
}

/* 2. ä¸»å®¹å™¨è®¾ç½® (ä¿®æ”¹ç‚¹ï¼šå‡å°åº•éƒ¨ç•™ç™½) */
#chat {
    background: transparent !important;
    position: relative !important;
    z-index: 1 !important;
    padding-top: 60px !important;
    
    /* ã€ä¿®æ”¹ç‚¹ã€‘ï¼šä¹‹å‰æ˜¯ 100pxï¼Œå¤ªå¤§äº†ï¼Œç°åœ¨æ”¹ä¸º 20px */
    padding-bottom: 20px !important; 
}


.last_mes {
    margin-bottom: 30px !important; 
}


/* === æ˜Ÿæ˜Ÿé—ªçƒç‰¹æ•ˆ === */
@keyframes twinkle {
    0% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.1); }
    100% { opacity: 0.3; transform: scale(1); }
}

#chat::before {
    content: "" !important;
    position: fixed !important;
    top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important;
    background-image: 
        radial-gradient(1.5px 1.5px at 10% 10%, #fff, transparent),
        radial-gradient(1px 1px at 20% 30%, #fff, transparent),
        radial-gradient(2px 2px at 30% 70%, #a5b4fc, transparent),
        radial-gradient(1.5px 1.5px at 40% 40%, #fff, transparent),
        radial-gradient(1px 1px at 50% 80%, #fff, transparent),
        radial-gradient(2px 2px at 60% 20%, #81a1f8, transparent),
        radial-gradient(1.5px 1.5px at 70% 50%, #fff, transparent),
        radial-gradient(1px 1px at 80% 90%, #fff, transparent),
        radial-gradient(1.5px 1.5px at 90% 15%, #fff, transparent) !important;
    background-size: 500px 500px !important;
    background-repeat: repeat !important;
    pointer-events: none !important;
    z-index: -10 !important; 
    animation: twinkle 6s infinite ease-in-out !important;
}

#chat::after {
    content: "" !important;
    position: fixed !important;
    top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important;
    background-image: 
        radial-gradient(2px 2px at 15% 65%, #ffffff, transparent),
        radial-gradient(2px 2px at 85% 25%, #bfdbfe, transparent) !important;
    background-size: 700px 700px !important;
    background-repeat: repeat !important;
    pointer-events: none !important;
    z-index: -10 !important;
    animation: twinkle 4s infinite ease-in-out reverse !important;
    opacity: 0.6 !important;
}

/* === éšè—åŸå§‹å›¾æ ‡ === */
#leftNavDrawerIcon *, #API-status-top *, #advanced-formatting-button .drawer-icon *,
#WIDrawerIcon *, #user-settings-button .drawer-icon *, #backgrounds-drawer-toggle .drawer-icon *,
#extensions-settings-button .drawer-icon *, #persona-management-button .drawer-icon *,
#rightNavDrawerIcon * {
    display: none !important; opacity: 0 !important; visibility: hidden !important;
}
#leftNavDrawerIcon::before, #leftNavDrawerIcon::after, #API-status-top::before, #API-status-top::after,
#advanced-formatting-button .drawer-icon::before, #advanced-formatting-button .drawer-icon::after,
#WIDrawerIcon::before, #WIDrawerIcon::after, #user-settings-button .drawer-icon::before, #user-settings-button .drawer-icon::after,
#backgrounds-drawer-toggle .drawer-icon::before, #backgrounds-drawer-toggle .drawer-icon::after,
#extensions-settings-button .drawer-icon::before, #extensions-settings-button .drawer-icon::after,
#persona-management-button .drawer-icon::before, #persona-management-button .drawer-icon::after,
#rightNavDrawerIcon::before, #rightNavDrawerIcon::after {
    display: none !important; content: none !important;
}

#leftNavDrawerIcon, #API-status-top, #advanced-formatting-button .drawer-icon,
#WIDrawerIcon, #user-settings-button .drawer-icon, #backgrounds-drawer-toggle .drawer-icon,
#extensions-settings-button .drawer-icon, #persona-management-button .drawer-icon,
#rightNavDrawerIcon {
    color: transparent !important; font-size: 0 !important;
    background-position: center !important; background-repeat: no-repeat !important;
    background-size: contain !important; display: inline-block !important;
    opacity: 1 !important; width: 40px !important; height: 40px !important;
    min-width: 40px !important; margin: 0 4px !important;
    filter: brightness(1.3) drop-shadow(0 0 2px rgba(129, 161, 248, 0.3)) !important;
}

/* === è‡ªå®šä¹‰å›¾æ ‡ URL === */
#leftNavDrawerIcon { 
    background-image: url('https://files.catbox.moe/mvxyea.png') !important; 
    width: 33px !important; 
    height: 33px !important; 
    transform: translateY(2px) !important; 
}

#API-status-top { background-image: url('https://files.catbox.moe/k16g56.png') !important; }
#advanced-formatting-button .drawer-icon { background-image: url('https://files.catbox.moe/65m8f3.png') !important; }
#WIDrawerIcon { background-image: url('https://files.catbox.moe/n0h2tg.png') !important; }
#user-settings-button .drawer-icon { background-image: url('https://files.catbox.moe/gi5tmc.png') !important; width: 44px !important; height: 44px !important; }
#backgrounds-drawer-toggle .drawer-icon { background-image: url('https://files.catbox.moe/epxntg.png') !important; }
#extensions-settings-button .drawer-icon { background-image: url('https://files.catbox.moe/79rgm7.png') !important; }
#persona-management-button .drawer-icon { background-image: url('https://files.catbox.moe/lgve4x.png') !important; }
#rightNavDrawerIcon { background-image: url('https://files.catbox.moe/g7stas.png') !important; transform: translateY(-2px) !important; }

/* === é¡¶éƒ¨å¯¼èˆªæ  === */
#top-bar {
    background: rgba(5, 5, 8, 0.8) !important; backdrop-filter: blur(10px) !important;
    border-bottom: 1px solid rgba(255,255,255,0.05) !important; box-shadow: none !important;
    position: fixed !important; top: 0 !important; width: 100% !important; height: 50px !important;
    z-index: 2000 !important; display: flex !important; align-items: center !important;
    justify-content: space-between !important; padding: 0 10px !important;
}
#top-bar * { color: rgba(255, 255, 255, 0.95) !important; }
#left-nav-panel { background: var(--xuexitong-sidebar) !important; border: none !important; }
#right-nav-panel, .drawer-content { background: var(--xuexitong-card) !important; border-left: 1px solid var(--xuexitong-border) !important; }

/* === æ ¸å¿ƒæ°”æ³¡å¸ƒå±€ === */

/* --- é€šç”¨åŸºç¡€æ ·å¼ --- */
.mes {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    margin-bottom: 24px !important;
    padding: 16px !important;
    border-radius: 12px !important;
    transition: box-shadow 0.2s ease !important;
    overflow: visible !important;
    position: relative !important; 
    z-index: 100 !important; 
}

/* --- æ°”æ³¡é¡¶éƒ¨æ  (Charåå­—/æ—¥æœŸ) --- */
.mes_header {
    background-image: url('https://files.catbox.moe/pd4la6.jpeg') !important;
    background-size: auto 100% !important;
    background-repeat: repeat-x !important;
    background-position: left top !important;
    border-radius: 8px 8px 0 0 !important;
    padding: 6px 12px !important;
    margin: -17px -17px 10px -17px !important;
    border-bottom: 1px solid rgba(255,255,255,0.1) !important;
    text-shadow: 1px 1px 2px #000 !important;
    position: relative !important;
    z-index: 101 !important;
}

/* =========================================================
   === Char (è§’è‰²) æ°”æ³¡æ ·å¼ ===
   ========================================================= */
.mes:not([is_user="true"]) {
    background: linear-gradient(135deg, 
        rgba(8, 12, 20, 0.85) 0%, 
        rgba(15, 20, 35, 0.85) 100%
    ) !important;
    
    backdrop-filter: blur(5px) !important;
    -webkit-backdrop-filter: blur(5px) !important;

    background-image: none !important;
    
    /* å¤–æ¡†å®çº¿ */
    border: 2px solid rgba(165, 180, 252, 0.4) !important;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.6) !important;
}

.mes:not([is_user="true"]):hover {
    box-shadow: 0 8px 30px rgba(129, 161, 248, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.6) !important;
}

/* =========================================================
   === User (ç”¨æˆ·) æ°”æ³¡æ ·å¼ ===
   ========================================================= */
.mes[is_user="true"] {
    background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.15) 100%) !important;
    background-image: none !important;
    backdrop-filter: blur(5px) !important;
    -webkit-backdrop-filter: blur(5px) !important;
    
    /* å¤–æ¡†å®çº¿ */
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
    color: #F8FAFC !important;
}
.mes[is_user="true"]::before { display: none !important; }


/* === å¤´åƒåŒºåŸŸä¸è£…é¥° === */
.mesAvatarWrapper {
    display: flex !important; flex-direction: row !important; align-items: center !important;
    gap: 12px !important; padding: 0 0 10px 0 !important; width: 100% !important; margin: 0 !important;
    background: transparent !important; border: none !important; border-bottom: 1px solid rgba(255,255,255,0.08) !important;
    margin-bottom: 10px !important;
    position: relative !important; z-index: 102 !important;
}
.mes[is_user='true'] .mesAvatarWrapper { flex-direction: row-reverse !important; justify-content: flex-start !important; }

#chat .mes .avatar {
    position: relative !important; width: 50px !important; height: 50px !important;
    min-width: 50px !important; min-height: 50px !important; aspect-ratio: 1 / 1 !important;
    border-radius: 50% !important; overflow: visible !important; flex-shrink: 0 !important; z-index: 103 !important;
}

/* --- Char å¤´åƒè£…é¥° --- */
#chat .mes:not([is_user="true"]) .avatar::after {
    content: '' !important; display: block !important; position: absolute !important;
    top: -25px !important; left: 50% !important; transform: translateX(-50%) !important;
    width: 95px !important; height: 95px !important;
    background-image: url('https://files.catbox.moe/0frcaa.png') !important;
    background-size: contain !important; background-repeat: no-repeat !important;
    background-position: center bottom !important; 
    z-index: 104 !important; pointer-events: none !important;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)) !important;
}

/* --- User å¤´åƒè£…é¥° --- */
#chat .mes[is_user="true"] .avatar::after {
    content: '' !important; display: block !important; position: absolute !important;
    top: -10px !important; left: 50% !important; transform: translateX(-50%) !important;
    width: 80px !important; height: 60px !important;
    background-image: url('https://files.catbox.moe/n9ivi6.png') !important;
    background-size: contain !important; background-repeat: no-repeat !important;
    background-position: center bottom !important; 
    z-index: 104 !important; pointer-events: none !important;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)) !important;
}

/* --- å¤´åƒå›¾ç‰‡å‘å…‰ --- */
#chat .mes .avatar img {
    width: 100% !important; height: 100% !important; object-fit: cover !important;
    border-radius: 50% !important; 
    border: 2px solid rgba(255,255,255,0.4) !important;
    box-shadow: 0 0 15px rgba(129, 161, 248, 0.9), 0 0 30px rgba(56, 189, 248, 0.5) !important;
}

/* === æ–‡å­—æ ·å¼ === */
.ch_name { color: #F1F5F9 !important; text-shadow: 0 0 10px rgba(129, 161, 248, 0.5) !important; font-weight: 600 !important; font-size: 15px !important; margin: 0 !important; }
.mes[is_user='true'] .ch_name { color: var(--xuexitong-blue) !important; text-shadow: none !important; text-align: right !important; }
.mes_text { width: 100% !important; color: var(--xuexitong-text) !important; line-height: 1.7 !important; padding: 0 4px !important; }
.menu_button, .drawer-toggle, .right_menu_button { color: var(--xuexitong-blue) !important; border-radius: 8px !important; }
.timestamp { color: rgba(255,255,255,0.3) !important; font-size: 12px !important; }

/* === åº•éƒ¨è¾“å…¥æ  === */
#send_form {
    background: rgba(10, 10, 15, 0.9) !important; backdrop-filter: blur(20px) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5) !important; z-index: 9999 !important;
}
#send_textarea {
    background-color: rgba(255,255,255,0.05) !important; border: 1px solid rgba(255,255,255,0.1) !important;
    border-radius: 10px !important; color: var(--xuexitong-text) !important;
}
#send_textarea:focus {
    background-color: rgba(255,255,255,0.1) !important; border-color: var(--xuexitong-blue) !important;
    box-shadow: 0 0 0 1px rgba(116, 143, 252, 0.3) !important;
}
#send_textarea::placeholder { color: transparent !important; }
#nonQRFormItems:has(#send_textarea:placeholder-shown)::before {
    content: "æ‰€æœ‰çš„æ­§é€”éƒ½æŠŠä½ å¼•å‘æˆ‘èº«è¾¹"; background: linear-gradient(45deg, #A5B4FC, #81A1F8);
    -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
    color: #81A1F8; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-family: "SimSun", "Songti SC", serif !important; font-size: 0.65em; pointer-events: none; z-index: 10; opacity: 0.6;
}

/* === æ€ç»´é“¾ä¸å¸ƒå±€ä¿®å¤ === */
.mes_reasoning_header_title { font-size: 0 !important; }
.mes_reasoning_header_title::after {
    content: 'å®‡å®™çš„åŸå­æ°¸ä¸æ¹®ç­' !important; font-size: 15px !important; font-weight: 600 !important;
    vertical-align: middle !important; background: linear-gradient(90deg, #A5B4FC, #C4B5FD) !important;
    background-clip: text !important; -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important;
}
.mes_reasoning_header {
    display: flex !important; justify-content: center !important; align-items: center !important;
    margin: 12px auto !important; width: 100% !important; border: none !important; background: transparent !important; padding: 8px 0 !important;
}
.mes_reasoning_header::before {
    content: '' !important; display: block !important; width: 36px !important; height: 36px !important;
    background-image: url('https://files.catbox.moe/w8wj9t.jpeg') !important; background-size: cover !important;
    background-position: center !important; border-radius: 50% !important; opacity: 1 !important; margin-right: 10px !important;
    box-shadow: 0 0 10px rgba(165, 180, 252, 0.4) !important;
}
.mes_reasoning {
    margin-top: 8px !important; margin-left: 0 !important; padding: 12px 16px !important;
    background-color: rgba(0, 0, 0, 0.3) !important; border-radius: 8px !important;
    font-size: 13px !important; color: var(--xuexitong-text-light) !important; line-height: 1.6 !important;
    border: 1px solid rgba(255,255,255,0.05) !important;
}
.mes_reasoning_header .fa-brain, .mes_reasoning_header .fa-solid { display: none !important; }
#chat, #left-nav-panel, .drawer-content { padding-right: 0 !important; margin-right: 0 !important; border: none !important; }
#API-status-top, #advanced-formatting-button .drawer-icon, #WIDrawerIcon, #user-settings-button .drawer-icon,
#backgrounds-drawer-toggle .drawer-icon, #extensions-settings-button .drawer-icon, #persona-management-button .drawer-icon,
#rightNavDrawerIcon { transform: none !important; }

@media screen and (max-width: 768px) {
    #top-bar { height: 50px !important; padding: 0 4px !important; flex-wrap: nowrap !important; justify-content: space-around !important; }
    #leftNavDrawerIcon, #API-status-top, #advanced-formatting-button .drawer-icon, #WIDrawerIcon,
    #user-settings-button .drawer-icon, #backgrounds-drawer-toggle .drawer-icon, #extensions-settings-button .drawer-icon,
    #persona-management-button .drawer-icon, #rightNavDrawerIcon { width: 30px !important; height: 30px !important; min-width: 30px !important; margin: 0 1px !important; }
    #leftNavDrawerIcon { width: 27px !important; height: 27px !important; min-width: 27px !important; transform: translateY(-2px) !important; }
    #chat { padding-top: 60px !important; }
    #send_form { padding: 8px 8px !important; }
    #send_textarea { padding: 8px 10px !important; font-size: 14px !important; }
}

/* === è§‚æµ‹æ—¥å¿—æ–‡æ¡ˆ === */
#chat { counter-reset: ID-counter -1; }
.mes { counter-increment: ID-counter; }
.mesIDDisplay { font-size: 0 !important; width: 100% !important; }
.mesIDDisplay::before { content: 'ğŸŒŒ è§‚æµ‹æ—¥å¿—' ;) !important; font-size: 12px !important; color: rgba(255,255,255,0.3) !important; display: block !important; text-align: center !important; margin-bottom: 8px !important; letter-spacing: 1px !important; }
.mes_timer::before { content: 'â³ è§‚æµ‹æ—¶é•¿ '; margin-right: 2px; }
.mes_timer::after { content: 's'; margin-left: 2px; }
.tokenCounterDisplay::before { content: 'ğŸ’¾ è®°å½•æ•°æ® '; margin-right: 2px; }
.tokenCounterDisplay::after { content: ' tokens'; margin-left: 2px; }
.mes_timer, .mesIDDisplay, .tokenCounterDisplay { font-weight: normal !important; color: rgba(255,255,255,0.3) !important; font-size: 12px !important; }

#completion_prompt_manager_list { width: 85% !important; margin: auto !important; background: transparent !important; }
#completion_prompt_manager .completion_prompt_manager_prompt, .list-group-item, .extension_preset, .regex_entry, .cl_entry, .world_info_entry { color: rgba(255, 255, 255, 0.9) !important; }
.qr--buttons { opacity: 0 !important; visibility: hidden !important; max-height: 0 !important; transform: translateY(20px) !important; pointer-events: none !important; transition: all 0.3s ease-in-out !important; }
#send_form:focus-within .qr--buttons { opacity: 1 !important; visibility: visible !important; max-height: 120px !important; transform: translateY(0) !important; pointer-events: auto !important; }
